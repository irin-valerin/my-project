import os
import random
import sqlite3
import logging
from threading import Lock
from datetime import datetime, timedelta
from dotenv import load_dotenv
import telebot
from telebot import types
from apscheduler.schedulers.background import BackgroundScheduler
import pytz
import requests

# ===== –ù–ê–°–¢–†–û–ô–ö–ê –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø =====
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('bot.log'),
        logging.StreamHandler()
    ]
)
logger = logging.getLogger(__name__)

# ===== –ö–û–ù–°–¢–ê–ù–¢–´ =====
WEDDING_DATE = "2025-07-10"
TIMEZONE = "Europe/Moscow"
ADMINS = [969123149, 1317385378]
MAX_CONCURRENT_USERS = 50
DB_TIMEOUT = 30

# Emoji –¥–ª—è —Ä–µ–π—Ç–∏–Ω–≥–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
EMOJI_MAP = ["üò¢", "üôÅ", "üòê", "üôÇ", "üòç"]

# ===== –°–õ–û–í–ê–†–ò –î–ê–ù–ù–´–• =====
DATE_IDEAS = {
        # –í–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å–ª–æ–≤–∞—Ä—å —Å –∏–¥–µ—è–º–∏...
        # –†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –∫–∞—Ñ–µ
        "–£–∂–∏–Ω –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ '–¢–µ—Ä—Ä–∞—Å–∞'": {
            "desc": "–ü–∞–Ω–æ—Ä–∞–º–Ω—ã–π –≤–∏–¥ –Ω–∞ –°–µ–≤–µ—Ä–Ω—É—é –î–≤–∏–Ω—É, –∫—É—Ö–Ω—è —Å–µ–≤–µ—Ä–Ω—ã—Ö –Ω–∞—Ä–æ–¥–æ–≤",
            "url": "https://terrasa29.ru",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },
        "–î–µ–≥—É—Å—Ç–∞—Ü–∏—è –≤ '–ü–æ–º–æ—Ä—Å–∫–æ–º –∫–∞—Ñ–µ'": {
            "desc": "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ç—Ä–æ–π—á–∞—Ç–∫—É, –∫–æ–∑—É–ª–∏ –∏ –¥—Ä—É–≥–∏–µ –ø–æ–º–æ—Ä—Å–∫–∏–µ –¥–µ–ª–∏–∫–∞—Ç–µ—Å—ã",
            "url": "https://vk.com/pomorskoe_cafe",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },
        "–£–∂–∏–Ω –≤ 'Roomi'": {
            "desc": "–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –±–ª—é–¥–∞ —Å–µ–≤–µ—Ä–Ω–æ–π –∫—É—Ö–Ω–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ —É—Ö–∞ –Ω–∞ —Å—É—à—ë–Ω–æ–π —Ä—ã–±–µ, –æ–ª–µ–Ω–∏–Ω–∞ –Ω–∞ —à–∏—à–∫–∞—Ö, —Ç—Ä–µ—Å–∫–∞ —Å –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å–Ω—ã–º –ø—é—Ä–µ –∏ –º–∞–ª–æ—Å–æ–ª—å–Ω—ã–º–∏ –æ–≥—É—Ä—Ü–∞–º–∏, –∞ —Ç–∞–∫–∂–µ –¥–µ—Å–µ—Ä—Ç—ã, —Ç–∞–∫–∏–µ –∫–∞–∫ ¬´–•–ª–µ–± –∏ —Å–æ–ª—å¬ª –∏ —Å–µ–≤–µ—Ä–Ω—ã–µ –¥–µ—Å–µ—Ä—Ç—ã —Å —è–≥–µ–ª–µ–º, –±–µ–ª—ã–º –≥—Ä–∏–±–æ–º –∏ –±–æ—Ä–æ–¥–∏–Ω—Å–∫–∏–º —Ö–ª–µ–±–æ–º.",
            "url": "https://roomi.one/roomirestaurant",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },
        "–£–∂–∏–Ω –≤ '–ê–Ω—Ä–æ–≤'": {
            "desc": "–ì–æ—Å—Ç—è–º –Ω—Ä–∞–≤–∏—Ç—Å—è –º–µ—Å—Ç–Ω–∞—è –∫—É—Ö–Ω—è, –æ—Å–æ–±–µ–Ω–Ω–æ –ø–µ–ª—å–º–µ–Ω–∏ –∏–∑ —â—É–∫–∏ —Å –±—É–ª—å–æ–Ω–æ–º –∏–∑ –±–µ–ª—ã—Ö –≥—Ä–∏–±–æ–≤, –ø–∞–ª—Ç—É—Å –≤ –∏–∫–æ—Ä–Ω–æ–º —Å–æ—É—Å–µ, —Ç—Ä–µ—Å–∫–∞ —Å –º—É—Å—Å–æ–º –∏–∑ —Ü–≤–µ—Ç–Ω–æ–π –∫–∞–ø—É—Å—Ç—ã, –∞ —Ç–∞–∫–∂–µ –¥–µ—Å–µ—Ä—Ç—ã, —Ç–∞–∫–∏–µ –∫–∞–∫ —á–µ—Ä–µ–º—É—Ö–æ–≤–æ–µ –ø–∏—Ä–æ–∂–Ω–æ–µ —Å —á–∞–µ–º –∏–∑ –±—Ä—É—Å–Ω–∏–∫–∏, —è–≥–æ–¥ –º–æ—Ä–æ—à–∫–∏, —à–∏—à–µ–∫ –∏ —Ç—Ä–∞–≤.",
            "url": "https://anrov.ru",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },
        "–£–∂–∏–Ω –≤ 'El Fuego'": {
            "desc": "–†–µ—Å—Ç–æ—Ä–∞–Ω El Fuego —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –∞—Ä–≥–µ–Ω—Ç–∏–Ω—Å–∫–æ–π –∫—É—Ö–Ω–µ, –Ω–æ —Ç–∞–∫–∂–µ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –±–ª—é–¥–∞ –ø–æ–º–æ—Ä—Å–∫–æ–π –∫—É—Ö–Ω–∏. ",
            "url": "https://vk.com/elfuegorestaurant",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },
        "–£–∂–∏–Ω –≤ 'Inside'": {
            "desc": "–í –º–µ–Ω—é –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –∞–≤—Ç–æ—Ä—Å–∫–∏–µ –±–ª—é–¥–∞ –µ–≤—Ä–æ–ø–µ–π—Å–∫–æ–π –∫—É—Ö–Ω–∏, –∏–∑—ã—Å–∫–∞–Ω–Ω—ã–µ –¥–µ—Å–µ—Ä—Ç—ã, –∫—Ä–∞–±—ã –∏–∑ –º–µ–Ω—é ¬´–ê–∫–≤–∞—Ä–∏—É–º¬ª, –∞ —Ç–∞–∫–∂–µ –±–æ–≥–∞—Ç–∞—è –≤–∏–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞. ",
            "url": "https://inside-rest.ru",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },
         "–£–∂–∏–Ω –≤ '–°—Ç–∞—Ä—ã–π –¢–∏—Ñ–ª–∏—Å'": {
            "desc": "–ì–æ—Å—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é—Ç –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Ä—É–ª–µ—Ç–∏–∫–∏ –∏–∑ –±–∞–∫–ª–∞–∂–∞–Ω–æ–≤ —Å —Å—ã—Ä–æ–º –∏ —á–µ—Å–Ω–æ–∫–æ–º, —Ö–∞—á–∞–ø—É—Ä–∏ –ø–æ-–º–µ–≥—Ä–µ–ª—å—Å–∫–∏, —Ö–∏–Ω–∫–∞–ª–∏ —Å –±–∞—Ä–∞–Ω–∏–Ω–æ–π –∏ –≥–æ–≤—è–¥–∏–Ω–æ–π, –∂–∞—Ä–µ–Ω—ã–π —Å—É–ª—É–≥—É–Ω–∏ –∏ –¥–æ–ª–º—É",
            "url": "https://vk.com/s_tiflis",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },
        "–£–∂–∏–Ω –≤ '–ü—Ä–µ—Å—Ç–æ'": {
            "desc": "–ü–æ —Å–ª–æ–≤–∞–º –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π, –∑–¥–µ—Å—å –≥–æ—Ç–æ–≤—è—Ç –æ—á–µ–Ω—å –≤–∫—É—Å–Ω—É—é –ø–∏—Ü—Ü—É, —Ä–æ–ª–ª—ã –∏ —Å—É—à–∏, –∞ —Ç–∞–∫–∂–µ —Å—ã—Ä–Ω—ã–π –∫—Ä–µ–º-—Å—É–ø, –∫–∞—Ä–∞–º–µ–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–∞–∫–ª–∞–∂–∞–Ω—ã –∏ —Ç–µ–ª—è—á—å–∏ —â–µ—á–∫–∏.",
            "url": "https://vk.com/presto",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },
        "–£–∂–∏–Ω –≤ '–°—Ç–∞—Ä–µ –ú–µ—Å—Ç–æ'": {
            "desc": "¬´–°—Ç–∞—Ä–µ –ú–µ—Å—Ç–æ¬ª ‚Äî —ç—Ç–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω, —Å—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥ —á–µ—à—Å–∫—É—é –ø–∏–≤–Ω—É—é.",
            "url": "https://vk.com/presto",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },
        "–£–∂–∏–Ω –≤ '–°—Ç–∞—Ä–µ –ú–µ—Å—Ç–æ'": {
            "desc": "¬´–°—Ç–∞—Ä–µ –ú–µ—Å—Ç–æ¬ª ‚Äî —ç—Ç–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω, —Å—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥ —á–µ—à—Å–∫—É—é –ø–∏–≤–Ω—É—é.",
            "url": "https://vk.com/presto",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },
        "–í—ã–ø–∏—Ç—å –∫–æ—Ñ–µ –≤ '1234'": {
            "desc": "–ú–µ–Ω—é —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–µ –∏ –≤–∫—É—Å–Ω–æ–µ, –∫–∞–∂–¥—ã–π –Ω–∞–π–¥–µ—Ç —á—Ç–æ-—Ç–æ —Å–µ–±–µ –ø–æ –¥—É—à–µ. –ë–ª—é–¥–∞ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω—ã —Å –¥—É—à–æ–π, –∞ –ø–æ—Ä—Ü–∏–∏ —â–µ–¥—Ä—ã–µ. –û—Å–æ–±–µ–Ω–Ω–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—Ç –¥–µ—Å–µ—Ä—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞ ‚Äî –Ω–∞—Å—Ç–æ—è—â–∏–µ —à–µ–¥–µ–≤—Ä—ã. ",
            "url": "https://vk.com/coffee_na_1234",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },
        "–í—ã–ø–∏—Ç—å –∫–æ—Ñ–µ –≤ '–ê–Ω–¥–µ—Ä–°–æ–Ω'": {
            "desc": "–ö–∞—Ñ–µ ¬´–ê–Ω–¥–µ—Ä–°–æ–Ω¬ª ‚Äî —ç—Ç–æ —É—é—Ç–Ω–æ–µ —Å–µ–º–µ–π–Ω–æ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ, –≥–¥–µ –º–æ–∂–Ω–æ –Ω–µ —Ç–æ–ª—å–∫–æ –≤–∫—É—Å–Ω–æ –ø–æ–µ—Å—Ç—å, –Ω–æ –∏ –Ω–∞—Å–ª–∞–¥–∏—Ç—å—Å—è –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ–π –¥–æ–º–∞—à–Ω–µ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä–æ–π.",
            "url": "https://anderson29.ru",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },
        "–í—ã–ø–∏—Ç—å –∫–æ—Ñ–µ –≤ '–ü–∏—Ü—Ü–∞–§–∞–±—Ä–∏–∫–∞'": {
            "desc": "–†–µ—Å—Ç–æ—Ä–∞–Ω ¬´–ü–∏—Ü—Ü–∞–§–∞–±—Ä–∏–∫–∞¬ª ‚Äî —ç—Ç–æ –∏–¥–µ–∞–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è —Å–µ–º–µ–π–Ω–æ–≥–æ –æ—Ç–¥—ã—Ö–∞ –∏–ª–∏ –¥—Ä—É–∂–µ—Å–∫–∏—Ö –≤—Å—Ç—Ä–µ—á. –ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Å–ª–∞–¥–∏—Ç—å—Å—è –≤–∫—É—Å–Ω–æ–π –∏ —Å–≤–µ–∂–µ–π –ø–∏—Ü—Ü–µ–π, –∞ —Ç–∞–∫–∂–µ –¥—Ä—É–≥–∏–º–∏ –±–ª—é–¥–∞–º–∏, —Ç–∞–∫–∏–º–∏ –∫–∞–∫ —Å–∞–ª–∞—Ç—ã, —Å—É–ø—ã, –∑–∞–∫—É—Å–∫–∏ –∏ –≥–æ—Ä—è—á–∏–µ –±–ª—é–¥–∞.",
            "url": "https://pizzafabrika.ru",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },
        # –ê–∫—Ç–∏–≤–Ω—ã–π –æ—Ç–¥—ã—Ö
        "–ö–∞—Ç–∞–Ω–∏–µ –Ω–∞ —Ö–∞—Å–∫–∏ –≤ '–°—É–≥—Ä–æ–±–µ'": {
            "desc": "–ü–∏—Ç–æ–º–Ω–∏–∫ –µ–∑–¥–æ–≤—ã—Ö —Å–æ–±–∞–∫ –≤ 30 –∫–º –æ—Ç –≥–æ—Ä–æ–¥–∞",
            "url": "https://sugrob29.ru",
            "season": "–¥–µ–∫–∞–±—Ä—å-–º–∞—Ä—Ç"
        },
        "–≠–∫—Å–∫—É—Ä—Å–∏—è  –Ω–∞ –∫–≤–∞–¥—Ä–æ—Ü–∏–∫–ª–∞—Ö": {
            "desc": "–≠–∫—Å–∫—É—Ä—Å–∏—è –ø–æ –ª–µ—Å–Ω—ã–º —Ç—Ä–æ–ø–∞–º —Å –æ–±–µ–¥–æ–º —É –∫–æ—Å—Ç—Ä–∞",
            "url": "https://vk.com/quadro29",
            "season": "–º–∞–π-–æ–∫—Ç—è–±—Ä—å"
        },
        "–ù–µ–≤–µ—Ä–æ—è—Ç–Ω–∞—è —Ä—ã–±–∞–ª–∫–∞ –Ω–∞ –ë–µ–ª–æ–º –º–æ—Ä–µ": {
            "desc": "–ì–æ—Ç–æ–≤—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —á–∞—Å–æ–≤ –¥–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–Ω–µ–π –≤–æ–∑–º–æ–∂–Ω—ã –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–∞—Ö —è—Ö—Ç, —Å–∫–æ—Ä–æ—Å—Ç–Ω—ã–µ –∏ –ø–∞—Ä—É—Å–Ω—ã–µ, –¥–ª—è –±–æ–ª—å—à–æ–π –∫–æ–º–ø–∞–Ω–∏–∏ –∏–ª–∏ –≥—Ä—É–ø–ø–æ–≤–æ–π —Ä—ã–±–∞–ª–∫–∏, –¥–ª—è —Å–µ–º–µ–π–Ω–æ–≥–æ –∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ –æ—Ç–¥—ã—Ö–∞.",
            "url": "https://yacht29.ru/fishing.html",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },
        "–¢–∞–π–Ω–∏–∫–∏ —Å–µ–≤–µ—Ä–∞": {
            "desc": "–ü—Ä–æ–≤–µ—Å—Ç–∏ –≤—Ä–µ–º—è —Å –¥—Ä—É–∑—å—è–º–∏ –∏ –ª—é–±–∏–º—ã–º–∏ –≤ –¥–∞–ª–∏ –æ—Ç –≥–æ—Ä–æ–¥–∞ –∏ —Å—É–µ—Ç—ã, –Ω–∞ –µ–¥–∏—Ç–µ —Å –ø—Ä–∏—Ä–æ–¥–æ–π, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ª—É—á—à–µ? ",
            "url": "https://vk.com/tainik29",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },
        "–†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –Ω–æ—á–Ω–∞—è –ø—Ä–æ–≥—É–ª–∫–∞ ": {
            "desc": "–ú–∞—Ä—à—Ä—É—Ç –ø—Ä–æ–ª–µ–≥–∞–µ—Ç –ø–æ –∑–∞–ø–∞–¥–Ω–æ–º—É —Ä—É–∫–∞–≤—É –°–µ–≤–µ—Ä–Ω–æ–π –î–≤–∏–Ω—ã ‚Äì –ù–∏–∫–æ–ª—å—Å–∫–æ–º—É. –í—ã –ø—Ä–æ–π–¥–µ—Ç–µ –ø–æ –∂–∏–≤–æ–ø–∏—Å–Ω—ã–º –ø—Ä–æ—Ç–æ–∫–∞–º –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ —Ñ–∞—Ä–≤–∞—Ç–µ—Ä–∞ –æ–±—à–∏—Ä–Ω–æ–π –¥–µ–ª—å—Ç—ã —Ä–µ–∫–∏, –ø–æ–ª—é–±—É–µ—Ç–µ—Å—å –ø–µ–π–∑–∞–∂–∞–º–∏ –º–Ω–æ–≥–æ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –æ—Å—Ç—Ä–æ–≤–æ–≤ –∏ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—â–µ–π –ø–∞–Ω–æ—Ä–∞–º–æ–π –≥–æ—Ä–æ–¥–∞ –Ω–∞–¥ –î–≤–∏–Ω–æ–π. ",
            "url": "https://bulatova.travel/catalogs/1/sections/11/products/872",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },
        "–ü–æ–ª–µ—Ç –Ω–∞ –ø–∞—Ä–∞–ø–ª–∞–Ω–µ ": {
            "desc": "–ü–æ–ª–µ—Ç –Ω–∞ –ø–∞—Ä–∞–ø–ª–∞–Ω–µ –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å —ç–∫—Å—Ç—Ä–∏–º–∞ –≤ –≤–∞—à –æ—Ç–¥—ã—Ö. –£–¥–∏–≤–∏—Ç–µ–ª—å–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–∑–≥–ª—è–Ω—É—Ç—å –Ω–∞ –º–∏—Ä —Å –≤—ã—Å–æ—Ç—ã –ø–æ–ª–µ—Ç–∞. ",
            "url": "https://vk.com/paraplan29vel/catalogs/1/sections/11/products/872",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },
        "–ö–æ–Ω–Ω–∞—è –ø—Ä–æ–≥—É–ª–∫–∞": {
            "desc": "–ï—â–µ –æ–¥–∏–Ω —Å–ø–æ—Å–æ–± –∫–ª–∞—Å—Å–Ω–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ –≤—Ä–µ–º—è –Ω–∞ –ø—Ä–∏—Ä–æ–¥–µ, –∏ –∑–∞–±—ã—Ç—å —á—Ç–æ —Ç–∞–∫–æ–µ —Å—É–µ—Ç–∞ - —ç—Ç–æ –∫–æ–Ω–Ω–∞—è –ø—Ä–æ–≥—É–ª–∫–∞ ",
            "url": "https://vk.com/countryclub2016",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },
        "–ì–∏–ª—å–¥–∏—è –∫–≤–µ—Å—Ç–æ–≤": {
            "desc": "–ó–¥–µ—Å—å –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –∫–≤–µ—Å—Ç—ã –ø–æ –≤—Å–µ–º –≤–∞—à–∏–º –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—è–º, –æ—Ç –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–æ —Å—Ç—Ä–∞—à–Ω—ã—Ö. –ò–≥—Ä–æ–∫–∞–º –ø—Ä–µ–¥—Å—Ç–æ–∏—Ç –ø—Ä–æ–π—Ç–∏ –ª–∞–±–∏—Ä–∏–Ω—Ç –∏ –Ω–∞–π—Ç–∏ —Å–æ–∫—Ä–æ–≤–∏—â–∞. –≠—Ç–æ –∏—Å–ø—ã—Ç–∞–Ω–∏–µ –Ω–∞ –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å, —Å–º–µ–ª–æ—Å—Ç—å –∏ –∫–æ–º–∞–Ω–¥–Ω—É—é —Ä–∞–±–æ—Ç—É. ",
            "url": "https://arx.questguild.ru",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },


        # –ö—É–ª—å—Ç—É—Ä–Ω—ã–µ
        "–ù–æ—á—å –≤ –º—É–∑–µ–µ –ú–∞–ª—ã–µ –ö–æ—Ä–µ–ª—ã": {
            "desc": "–í–µ—á–µ—Ä–Ω–∏–µ —ç–∫—Å–∫—É—Ä—Å–∏–∏ –ø—Ä–∏ —Å–≤–µ—á–∞—Ö –ø–æ –¥–µ—Ä–µ–≤—è–Ω–Ω—ã–º —Ü–µ—Ä–∫–≤—è–º",
            "url": "https://korely.ru",
            "season": "–∏—é–Ω—å-–∞–≤–≥—É—Å—Ç"
        },
        "–ú–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å –ø–æ –∫–æ–∑—É–ª—è–º": {
            "desc": "–†–æ—Å–ø–∏—Å—å —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö –ø—Ä—è–Ω–∏–∫–æ–≤ –≤ –º—É–∑–µ–µ '–ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫–∏–π –ø—Ä—è–Ω–∏–∫'",
            "url": "https://arhmuseum.ru",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },
        "–ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫–∏–π —Ç–µ–∞—Ç—Ä –¥—Ä–∞–º—ã": {
            "desc": "–ò–º–µ–Ω–Ω–æ –∑–¥–µ—Å—å –∫—É–ª—å—Ç—É—Ä–∞ –ø–µ—Ä–µ–∫–ª–∏–∫–∞–µ—Ç—Å—è —Å –∏—Å–∫—É—Å—Å—Ç–≤–æ–º",
            "url": "https://arhdrama.culture29.ru",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },
        "–ò—Å—Ç–æ—Ä–∏–∫–æ-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å ¬´–ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫–∏–µ –ì–æ—Å—Ç–∏–Ω—ã–µ –¥–≤–æ—Ä—ã¬ª": {
            "desc": "–≠—Ç–æ –æ–¥–∏–Ω –∏–∑ –ø–µ—Ä–≤—ã—Ö –∫—Ä–∞–µ–≤—ã—Ö –º—É–∑–µ–µ–≤ —Å—Ç—Ä–∞–Ω—ã. –ü–æ –±–æ–≥–∞—Ç—Å—Ç–≤—É, –º—É–∑–µ–π–Ω—ã–π —Ñ–æ–Ω–¥ –∏—Å—Ç–æ—Ä–∏–∫–æ-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ –∫–æ–º–ø–ª–µ–∫—Å–∞ –Ω–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø–æ—á—Ç–∏ 300 —Ç—ã—Å—è—á —ç–∫—Å–ø–æ–Ω–∞—Ç–æ–≤, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å –∫—Ä—É–ø–Ω–µ–π—à–∏–º –ø–æ –º–æ—â–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏ –æ–¥–Ω–∏–º –∏–∑ —Å–∞–º—ã—Ö –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã—Ö –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∫–æ–≤ –∏ –∫—Ä–∞–µ–≤–µ–¥–æ–≤. ",
            "url": "https://kraeved29.ru",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },
        # –ù–µ–æ–±—ã—á–Ω—ã–µ
        "–ù–æ—á—å –≤ –≥–ª—ç–º–ø–∏–Ω–≥–µ '–°–µ–≤–µ—Ä–Ω–æ–µ —Å–∏—è–Ω–∏–µ'": {
            "desc": "–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–µ –∫—É–ø–æ–ª–∞ —Å –ø–æ–¥–æ–≥—Ä–µ–≤–æ–º –≤ 50 –∫–º –æ—Ç –≥–æ—Ä–æ–¥–∞",
            "url": "https://glamping29.ru",
            "season": "—Å–µ–Ω—Ç—è–±—Ä—å-–∞–ø—Ä–µ–ª—å"
        },
        "–§–æ—Ç–æ—Å–µ—Å—Å–∏—è —É –º–∞—è–∫–∞ –ü—É—Ä-–ù–∞–≤–æ–ª–æ–∫": {
            "desc": "–°–∞–º—ã–π —Å–µ–≤–µ—Ä–Ω—ã–π –º–∞—è–∫ –†–æ—Å—Å–∏–∏ —Å –ø–æ—Ç—Ä—è—Å–∞—é—â–∏–º–∏ –≤–∏–¥–∞–º–∏",
            "url": None,
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },
        "–õ–µ–¥–æ–≤–∞—è –∞—Ä–µ–Ω–∞ –≤ –¢–†–¶ –¢–∏—Ç–∞–Ω–ê—Ä–µ–Ω–∞": {
            "desc": "–û—Ç–ª–∏—á–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Å—Ç–∏ –≤—Ä–µ–º—è —Å–æ –≤—Ç–æ—Ä–æ–π –ø–æ–ª–æ–≤–∏–Ω–∫–æ–π. –ù–∞ –∞—Ä–µ–Ω–µ —Ä–æ–≤–Ω—ã–π –ª–µ–¥, –±–æ–ª—å—à–∞—è –ø–ª–æ—â–∞–¥—å, –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∞—Ä–µ–Ω–¥—ã –∫–æ–Ω—å–∫–æ–≤.",
            "url": "http://titanarena.ru/icearena/",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },
         "–ì–æ–Ω—á–∞—Ä–Ω–∞—è –º–∞—Å—Ç–µ—Ä—Å–∫–∞—è –ê—Ä—Ç–ö–µ—Ä–∞–º–∏–∫–∞": {
            "desc": "–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π 2-—Ö —á–∞—Å–æ–≤–æ–π –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å –¥–ª—è –ø–∞—Ä—ã –æ—Ç –º–∞—Å—Ç–µ—Ä–∞ –≤ —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π –æ–±—Å—Ç–∞–Ω–æ–≤–∫–µ. –°–¥–µ–ª–∞–Ω–Ω–æ–µ –≤–∞–º–∏ –∏–∑–¥–µ–ª–∏–µ –æ–±–æ–∂–≥—É—Ç –∏ –æ–∫—Ä–∞—Å—è—Ç, –∞ —É –≤–∞—Å –±—É–¥–µ—Ç —Ä—É–∫–æ—Ç–≤–æ—Ä–Ω—ã–π —Å–∏–º–≤–æ–ª –≤–∞—à–µ–π –ª—é–±–≤–∏.",
            "url": "https://vk.com/market/product/svidanie-za-goncharnym-krugom-master-klass-dlya-pary-168852802-5704634?utm_act=show&utm_dmcah=&utm_hash=&utm_id=5704634&utm_is_znav=1&utm_loc=uslugi-168852802&utm_location_owner_id=-168852802&utm_oid=-168852802&utm_query=%7B%26quot%3Bsection%26quot%3B%3A%26quot%3Bsection%26quot%3B%2C%26quot%3Bsection_id%26quot%3B%3A%26quot%3BHUkaVBkFWVZxRwcDWVg2%26quot%3B%7D&utm_ref=",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },
        "–°–ø–∞ —Ü–µ–Ω—Ç—Ä Sultan Spa": {
            "desc": "–°–ø–∞ —Ü–µ–Ω—Ç—Ä Sultan Spa - –∑–¥–µ—Å—å –≤—ã –Ω–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏—è—Ç–Ω–æ –ø—Ä–æ–≤–µ–¥–µ—Ç–µ –≤—Ä–µ–º—è –≤–º–µ—Å—Ç–µ, –Ω–æ –∏ –ø—Ä–æ–≤–µ–¥–µ—Ç–µ –µ–≥–æ —Å –ø–æ–ª—å–∑–æ–π. –í —Å–ø–∞ —Ü–µ–Ω—Ç—Ä–µ –∏–º–µ–µ—Ç—Å—è –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø—Ä–æ–≥—Ä–∞–º–º –ø–æ–¥ –∫–∞–∂–¥—ã–π –≤–∞—à –∑–∞–ø—Ä–æ—Å.",
            "url": "https://sultanspa.tilda.ws/dates",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        },
        # –ó–∞–≥–æ—Ä–æ–¥–Ω—ã–µ
        "–¢—É—Ä –Ω–∞ –°–æ–ª–æ–≤–∫–∏ –Ω–∞ –≤—ã—Ö–æ–¥–Ω—ã–µ": {
            "desc": "–ü–µ—Ä–µ–ª–µ—Ç –Ω–∞ —Å–∞–º–æ–ª–µ—Ç–µ –∏–∑ –ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫–∞ (1 —á–∞—Å –≤ –ø—É—Ç–∏)",
            "url": "https://solovki29.ru",
            "season": "–∏—é–Ω—å-—Å–µ–Ω—Ç—è–±—Ä—å"
        },
        "–†—ã–±–∞–ª–∫–∞ –Ω–∞ –æ–∑–µ—Ä–µ –õ–∞—á–∞": {
            "desc": "–ê—Ä–µ–Ω–¥–∞ –¥–æ–º–∏–∫–∞ —Å –±–∞–Ω–µ–π –∏ —Å–Ω–∞—Å—Ç—è–º–∏",
            "url": "https://vk.com/lacha_fishing",
            "season": "–∫—Ä—É–≥–ª—ã–π –≥–æ–¥"
        }

}

COMPLIMENTS = [
    "–¢—ã ‚Äî –º–æ—è —Ä–∞–¥–æ—Å—Ç—å!", "–° —Ç–æ–±–æ–π –∫–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –ø—Ä–∞–∑–¥–Ω–∏–∫!","–¢—ã –ø—Ä–µ–≤—Ä–∞—â–∞–µ—à—å –æ–±—ã—á–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –≤ –≤–æ–ª—à–µ–±–Ω—ã–µ","–ö–∞–∂–¥—ã–π –¥–µ–Ω—å —Å —Ç–æ–±–æ–π ‚Äî –∫–∞–∫ –º–∞–ª–µ–Ω—å–∫–æ–µ —á—É–¥–æ"," –¢–≤–æ–∏ –≥–ª–∞–∑–∞ ‚Äî –∫–∞–∫ –¥–≤–µ –≤—Å–µ–ª–µ–Ω–Ω—ã—Ö, –≤ –∫–æ—Ç–æ—Ä—ã—Ö —è —Ö–æ—á—É –ø–æ—Ç–µ—Ä—è—Ç—å—Å—è","–°–ø–∞—Å–∏–±–æ, —á—Ç–æ —Ç—ã –µ—Å—Ç—å. –¢—ã –¥–µ–ª–∞–µ—à—å –º–æ—é –∂–∏–∑–Ω—å —è—Ä—á–µ –∏ —Ç–µ–ø–ª–µ–µ","–¢—ã —É–º–µ–µ—à—å –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å —Ç–∞–∫, –∫–∞–∫ –Ω–∏–∫—Ç–æ –¥—Ä—É–≥–æ–π","–ú–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è, –∫–∞–∫ —Ç—ã –∑–∞–±–æ—Ç–∏—à—å—Å—è –æ–±–æ –º–Ω–µ, –¥–∞–∂–µ –≤ –º–µ–ª–æ—á–∞—Ö","–¢—ã ‚Äî –º–æ–π —Å–∞–º—ã–π –Ω–∞–¥—ë–∂–Ω—ã–π —á–µ–ª–æ–≤–µ–∫, –º–æ—è —Ç–∏—Ö–∞—è –≥–∞–≤–∞–Ω—å","–¢—ã ‚Äî —á–µ–ª–æ–≤–µ–∫, —Ä–∞–¥–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ —Ö–æ—á–µ—Ç—Å—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –ª—É—á—à–µ","–†—è–¥–æ–º —Å —Ç–æ–±–æ–π –¥–∞–∂–µ —Ç–∏—à–∏–Ω–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–π","–¢—ã ‚Äî —Ç–æ—Ç —á–µ–ª–æ–≤–µ–∫, —Ä—è–¥–æ–º —Å –∫–æ—Ç–æ—Ä—ã–º —è –∑–∞–±—ã–≤–∞—é, —á—Ç–æ —Ç–∞–∫–æ–µ –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ","–¢–≤–æ—è —É–ª—ã–±–∫–∞ ‚Äî –º–æ–π —Å–∞–º—ã–π –ª—é–±–∏–º—ã–π –≤–∏–¥ —Å—á–∞—Å—Ç—å—è","–¢—ã –∑–∞—Ç–º–µ–≤–∞–µ—à—å —Å–æ–ª–Ω—Ü–µ, –∫–æ–≥–¥–∞ –ø–æ—è–≤–ª—è–µ—à—å—Å—è –≤ –∫–æ–º–Ω–∞—Ç–µ","–î–∞–∂–µ —Å–ø—É—Å—Ç—è –≥–æ–¥—ã —Ç—ã –∑–∞—Å—Ç–∞–≤–ª—è–µ—à—å –º–æ–µ —Å–µ—Ä–¥—Ü–µ –±–∏—Ç—å—Å—è —á–∞—â–µ","–¢—ã ‚Äî –º–æ–π –ª–∏—á–Ω—ã–π –∞–Ω—Ç–∏—Å—Ç—Ä–µ—Å—Å","–° —Ç–æ–±–æ–π —è —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –∫–∞–∫ –Ω–∏ —Å –∫–µ–º –¥—Ä—É–≥–∏–º"
]

TRUTHS = [
     "–ö–∞–∫–æ–µ —Ç–≤–æ–µ —Å–∞–º–æ–µ –Ω–µ–ª–æ–≤–∫–æ–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –Ω–∞—Å?",
    "–ß—Ç–æ —Ç–µ–±–µ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –≤–æ –º–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è?",
    "–û —á–µ–º —Ç—ã –º–µ—á—Ç–∞–ª(–∞) –≤ –¥–µ—Ç—Å—Ç–≤–µ?",
    "–ö–∞–∫–æ–π –Ω–∞—à –º–æ–º–µ–Ω—Ç –±—ã–ª —Å–∞–º—ã–º —Ä–æ–º–∞–Ω—Ç–∏—á–Ω—ã–º?",
    "–ë—ã–ª(–∞) –ª–∏ —Ç—ã –≤–ª—é–±–ª–µ–Ω(–∞) –≤ –∫–æ–≥–æ-—Ç–æ –∏–∑ –º–æ–∏—Ö –¥—Ä—É–∑–µ–π?",
    "–ö–∞–∫–æ–π –º–æ–π –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ —Ç–µ–±—è —Ä–∞–∑–¥—Ä–∞–∂–∞–µ—Ç?",
    "–ï—Å–ª–∏ –±—ã –º—ã –º–æ–≥–ª–∏ –ø–æ–µ—Ö–∞—Ç—å –≤ –ª—é–±–æ–µ –º–µ—Å—Ç–æ, –∫—É–¥–∞ –±—ã —Ç—ã –≤—ã–±—Ä–∞–ª(–∞)?",
    "–ß—Ç–æ —Ç—ã –≤–ø–µ—Ä–≤—ã–µ –ø–æ–¥—É–º–∞–ª(–∞) –æ–±–æ –º–Ω–µ –ø—Ä–∏ –≤—Å—Ç—Ä–µ—á–µ?",
    "–ö–∞–∫–æ–π —Å–µ–∫—Ä–µ—Ç —Ç—ã –º–Ω–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–ª(–∞)?",
    "–ß—Ç–æ –±—ã —Ç—ã –∏–∑–º–µ–Ω–∏–ª(–∞) –≤ –Ω–∞—à–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö?",
    "–¢—ã —Ä–µ–≤–Ω—É–µ—à—å –º–µ–Ω—è –∫ –∫–æ–º—É-—Ç–æ? –ö –∫–æ–º—É –∏–º–µ–Ω–Ω–æ?",
    "–ö–∞–∫–æ–π —Ç–≤–æ–π —Å–∞–º—ã–π –ø–æ—Å—Ç—ã–¥–Ω—ã–π –ø–æ—Å—Ç—É–ø–æ–∫?",
    "–ë—ã–ª–æ –ª–∏ —É —Ç–µ–±—è –ø—Ä–µ–¥—á—É–≤—Å—Ç–≤–∏–µ, —á—Ç–æ –º—ã –±—É–¥–µ–º –≤–º–µ—Å—Ç–µ?",
    "–ö–∞–∫–æ–π –º–æ–º–µ–Ω—Ç –≤ –Ω–∞—à–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö —Ç—ã —Ö–æ—Ç–µ–ª(–∞) –±—ã –ø–µ—Ä–µ–∂–∏—Ç—å —Å–Ω–æ–≤–∞?",
    "–ß—Ç–æ —Ç–µ–±—è –≤–æ –º–Ω–µ –±–µ—Å–∏—Ç, –Ω–æ —Ç—ã —Ç–µ—Ä–ø–∏—à—å?",
    "–ï—Å–ª–∏ –±—ã —Ç—ã –º–æ–≥(–ª–∞) –∏–∑–º–µ–Ω–∏—Ç—å –æ–¥–Ω—É –º–æ—é –ø—Ä–∏–≤—ã—á–∫—É, –∫–∞–∫—É—é –±—ã –≤—ã–±—Ä–∞–ª(–∞)?",
    "–û —á–µ–º —Ç—ã —á–∞—â–µ –≤—Å–µ–≥–æ –ª–∂–µ—à—å –º–Ω–µ?",
    "–ö–∞–∫–æ–π —Ç–≤–æ–π —Å–∞–º—ã–π —Å—Ç—Ä–∞–Ω–Ω—ã–π —Ñ–µ—Ç–∏—à?",
    "–ë—ã–ª(–∞) –ª–∏ —Ç—ã –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö —Å –∫–µ–º-—Ç–æ —Ç–æ–ª—å–∫–æ –∏–∑-–∑–∞ –≤–Ω–µ—à–Ω–æ—Å—Ç–∏?",
    "–ß—Ç–æ —Å–∞–º–æ–µ –±–µ–∑—É–º–Ω–æ–µ, —á—Ç–æ —Ç—ã –¥–µ–ª–∞–ª(–∞) —Ä–∞–¥–∏ –ª—é–±–≤–∏?",
    "–¢—ã –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å –ø—Ä–æ–≤–µ—Ä—è–ª(–∞) –º–æ–π —Ç–µ–ª–µ—Ñ–æ–Ω?",
    "–ö–∞–∫–æ–π –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç —Ç–µ–±–µ –∑–∞–ø–æ–º–Ω–∏–ª—Å—è –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ?",
    "–¢—ã –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–ª(–∞) –Ω–∞—Å —á–µ—Ä–µ–∑ 10 –ª–µ—Ç? –ö–∞–∫ –º—ã –≤—ã–≥–ª—è–¥–∏–º?",
    "–ß—Ç–æ —Å–∞–º–æ–µ –≥–ª—É–ø–æ–µ, —á—Ç–æ —Ç—ã –¥–µ–ª–∞–ª(–∞), —á—Ç–æ–±—ã –ø—Ä–∏–≤–ª–µ—á—å –º–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ?",
    "–ö–∞–∫–æ–π —Ç–≤–æ–π –ª—é–±–∏–º—ã–π –º–æ–º–µ–Ω—Ç –Ω–∞—à–µ–π –∏–Ω—Ç–∏–º–Ω–æ–π –±–ª–∏–∑–æ—Å—Ç–∏?",
    "–ï—Å–ª–∏ –±—ã —É —Ç–µ–±—è –±—ã–ª –æ–¥–∏–Ω –¥–µ–Ω—å –±–µ–∑ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤, —á—Ç–æ –±—ã —Ç—ã —Å–¥–µ–ª–∞–ª(–∞)?",
    "–¢—ã –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å –ø–ª–∞–∫–∞–ª(–∞) –∏–∑-–∑–∞ –º–µ–Ω—è?",
    "–ß—Ç–æ —Å–∞–º–æ–µ —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω–æ–µ, —á—Ç–æ —Ç—ã –¥–µ–ª–∞–ª(–∞) –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö?",
    "–ö–∞–∫–æ–π —Ñ–∏–ª—å–º –∏–ª–∏ —Å–µ—Ä–∏–∞–ª –Ω–∞–ø–æ–º–∏–Ω–∞–µ—Ç —Ç–µ–±–µ –Ω–∞—à–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è?",
    "–¢—ã –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å —Ö–æ—Ç–µ–ª(–∞) —Ä–∞—Å—Å—Ç–∞—Ç—å—Å—è —Å–æ –º–Ω–æ–π? –ü–æ—á–µ–º—É?",
    "–ö–∞–∫–æ–π –ø–æ—Å—Ç—É–ø–æ–∫ —Ç—ã –Ω–∏–∫–æ–≥–¥–∞ –º–Ω–µ –Ω–µ –ø—Ä–æ—Å—Ç–∏—à—å?",
    "–ß—Ç–æ —Ç—ã —Å–∫—Ä—ã–≤–∞–µ—à—å –æ—Ç –º–µ–Ω—è –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å?",
    "–ï—Å–ª–∏ –±—ã —Ç—ã –º–æ–≥(–ª–∞) —É–∑–Ω–∞—Ç—å –ø—Ä–∞–≤–¥—É –æ–± –æ–¥–Ω–æ–º —Å–æ–±—ã—Ç–∏–∏ –≤ –º–æ–µ–π –∂–∏–∑–Ω–∏, —á—Ç–æ –±—ã —ç—Ç–æ –±—ã–ª–æ?",
    "–¢—ã –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å —Ñ–ª–∏—Ä—Ç–æ–≤–∞–ª(–∞) —Å –∫–µ–º-—Ç–æ, –ø–æ–∫–∞ –º—ã –≤–º–µ—Å—Ç–µ?",
    "–ß—Ç–æ —Å–∞–º–æ–µ —Å—Ç—Ä–∞–Ω–Ω–æ–µ, —á—Ç–æ —Ç—ã –Ω–∞—Ö–æ–¥–∏–ª(–∞) –≤–æ –º–Ω–µ –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–º?",
    "–ö–∞–∫–æ–π —Ç–≤–æ–π —Å–∞–º—ã–π –±–æ–ª—å—à–æ–π —Å—Ç—Ä–∞—Ö –≤ –Ω–∞—à–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö?",
    "–¢—ã –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å –≥–æ–≤–æ—Ä–∏–ª(–∞) '–Ø —Ç–µ–±—è –ª—é–±–ª—é' –Ω–µ–∏—Å–∫—Ä–µ–Ω–Ω–µ?",
    "–ß—Ç–æ –±—ã —Ç—ã —Å–¥–µ–ª–∞–ª(–∞), –µ—Å–ª–∏ –±—ã —è –ø—Ä–µ–¥–ª–æ–∂–∏–ª(–∞) —Ç–µ–±–µ —Å–µ–∫—Å –≤ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–º –º–µ—Å—Ç–µ?",
    "–ö–∞–∫–æ–π –º–æ–º–µ–Ω—Ç –≤ –Ω–∞—à–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö –±—ã–ª –¥–ª—è —Ç–µ–±—è —Å–∞–º—ã–º —Ç—Ä—É–¥–Ω—ã–º?"
]

DARES = [
    "–°–ø–æ–π –∫—É–ø–ª–µ—Ç –ª—é–±–∏–º–æ–π –ø–µ—Å–Ω–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –≥–æ–ª–æ—Å–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º!",
    "–ù–∞–ø–∏—à–∏ –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥—É—é –±—É–∫–≤—É –∏–º–µ–Ω–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞",
    "–°—Ç–∞–Ω—Ü—É–π –ø–æ–¥ –ø–µ—Ä–≤—É—é –ø–µ—Å–Ω—é, –∫–æ—Ç–æ—Ä—É—é –Ω–∞–π–¥–µ—à—å –≤ –ø–ª–µ–π–ª–∏—Å—Ç–µ",
    "–ü—Ä–∏—à–ª–∏ —Ñ–æ—Ç–æ, –≥–¥–µ —Ç–µ–±–µ –º–µ–Ω—å—à–µ –≤—Å–µ–≥–æ –ª–µ—Ç",
    "–ü–æ–∫–∞–∂–∏ —Å–∞–º–æ–µ —Å–º–µ—à–Ω–æ–µ —Ñ–æ—Ç–æ –≤ —Å–≤–æ–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω–µ",
    "–°–¥–µ–ª–∞–π –º–∞—Å—Å–∞–∂ –ø–∞—Ä—Ç–Ω–µ—Ä—É –≤ —Ç–µ—á–µ–Ω–∏–µ 3 –º–∏–Ω—É—Ç",
    "–ò–∑–æ–±—Ä–∞–∑–∏ –∏–∑–≤–µ—Å—Ç–Ω—É—é –ª–∏—á–Ω–æ—Å—Ç—å, –ø–æ–∫–∞ –ø–∞—Ä—Ç–Ω–µ—Ä –Ω–µ —É–≥–∞–¥–∞–µ—Ç",
    "–ù–∞–ø–∏—à–∏ –ª—é–±–æ–≤–Ω–æ–µ —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ —Å —Ç—Ä–µ–º—è —Å–ª–æ–≤–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–∫–∞–∂–µ—Ç –ø–∞—Ä—Ç–Ω–µ—Ä",
    "–°—ä–µ—à—å —á—Ç–æ-—Ç–æ –æ—Å—Ç—Ä–æ–µ –±–µ–∑ –≤–æ–¥—ã –∏ –Ω–µ –º–æ—Ä—â–∏—Å—å",
    "–°–Ω–∏–º–∏ –≤–∏–¥–µ–æ, –∫–∞–∫ —Ç—ã –ø—ã—Ç–∞–µ—à—å—Å—è —Å–µ—Å—Ç—å –Ω–∞ —à–ø–∞–≥–∞—Ç",
    "–ü—Ä–∏—à–ª–∏ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å —Å–∞–º—ã–º —Å–æ–±–ª–∞–∑–Ω–∏—Ç–µ–ª—å–Ω—ã–º –≥–æ–ª–æ—Å–æ–º",
    "–°–¥–µ–ª–∞–π —Å–º–µ—à–Ω–æ–µ —Å–µ–ª—Ñ–∏ —Å –Ω–µ–æ–±—ã—á–Ω—ã–º –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º –ª–∏—Ü–∞",
    "–ü–æ–∫–∞–∂–∏ —Å–∞–º—É—é —Å—Ç—Ä–∞–Ω–Ω—É—é –≤–µ—â—å –≤ —Ç–≤–æ–µ–π –∫–æ–º–Ω–∞—Ç–µ",
    "–°—ä–µ—à—å –ª–æ–∂–∫—É —á–µ–≥–æ-—Ç–æ (–∫–µ—Ç—á—É–ø, –≥–æ—Ä—á–∏—Ü–∞) –±–µ–∑ –Ω–∏—á–µ–≥–æ",
    "–°–ø–æ–π –¥–µ—Ç—Å–∫—É—é –ø–µ—Å–µ–Ω–∫—É —Å —Å–µ—Ä—å–µ–∑–Ω—ã–º –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º –ª–∏—Ü–∞",
    "–°—Ç–∞–Ω—Ü—É–π —Ç–∞–Ω–µ—Ü –º–∞–ª–µ–Ω—å–∫–∏—Ö —É—Ç—è—Ç –∏ –ø—Ä–∏—à–ª–∏ –≤–∏–¥–µ–æ",
    "–ù–∞—Ä–∏—Å—É–π –ø–æ—Ä—Ç—Ä–µ—Ç –ø–∞—Ä—Ç–Ω–µ—Ä–∞ —Å –∑–∞–∫—Ä—ã—Ç—ã–º–∏ –≥–ª–∞–∑–∞–º–∏",
    "–°–¥–µ–ª–∞–π 10 –æ—Ç–∂–∏–º–∞–Ω–∏–π, –µ—Å–ª–∏ –Ω–µ —Å–º–æ–∂–µ—à—å - 20 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π",
    "–ü–æ–∑–≤–æ–Ω–∏ –ø–∞—Ä—Ç–Ω–µ—Ä—É –∏ –ø—Ä–æ–∫—É–∫–∞—Ä–µ–∫–∞–π –≤ —Ç—Ä—É–±–∫—É",
    "–ò–∑–æ–±—Ä–∞–∑–∏ 5 —ç–º–æ—Ü–∏–π –ø–æ–¥—Ä—è–¥, –∫–æ—Ç–æ—Ä—ã–µ —Å–∫–∞–∂–µ—Ç –ø–∞—Ä—Ç–Ω–µ—Ä",
    "–°—ä–µ—à—å —á—Ç–æ-–Ω–∏–±—É–¥—å —Å –∑–∞–∫—Ä—ã—Ç—ã–º–∏ –≥–ª–∞–∑–∞–º–∏, —á—Ç–æ –¥–∞—Å—Ç —Ç–µ–±–µ –ø–∞—Ä—Ç–Ω–µ—Ä",
    "–°–ø–æ–π –ª—é–±–æ–≤–Ω—É—é –ø–µ—Å–Ω—é, –∑–∞–∂–∞–≤ –Ω–æ—Å –ø–∞–ª—å—Ü–∞–º–∏",
    "–ü—Ä–∏—à–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–º–∞–π–ª–∏–∫ –≤ —Å–≤–æ–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω–µ –∏ –æ–±—ä—è—Å–Ω–∏, –ø–æ—á–µ–º—É –æ–Ω —Ç–∞–º",
    "–°–Ω–∏–º–∏ –≤–∏–¥–µ–æ, –∫–∞–∫ —Ç—ã –ø—ã—Ç–∞–µ—à—å—Å—è –ª–∏–∑–Ω—É—Ç—å —Å–≤–æ–π –ª–æ–∫–æ—Ç—å",
    "–ù–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–∞—Ä—Ç–Ω–µ—Ä—É —Ç–æ–ª—å–∫–æ —Å –ø–æ–º–æ—â—å—é —Å—Ç–∏–∫–µ—Ä–æ–≤",
    "–°–¥–µ–ª–∞–π –≤–∏–¥, —á—Ç–æ —Ç—ã –≤–µ–¥—É—â–∏–π —Ç–æ–∫-—à–æ—É –∏ –∏–Ω—Ç–µ—Ä–≤—å—é–∏—Ä—É–π –ø–∞—Ä—Ç–Ω–µ—Ä–∞ 2 –º–∏–Ω—É—Ç—ã",
    "–ü–æ–∫–∞–∂–∏ —Å–≤–æ—é —Å–∞–º—É—é –Ω–µ—É–¥–∞—á–Ω—É—é —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é",
    "–ò–∑–æ–±—Ä–∞–∑–∏ —Å—Ç–∞—Ç—É—é –ª—é–±–≤–∏ –∏ —Å—Ç–æ–π –Ω–µ–ø–æ–¥–≤–∏–∂–Ω–æ 1 –º–∏–Ω—É—Ç—É",
    "–°—ä–µ—à—å –±–∞–Ω–∞–Ω –∏–ª–∏ –∫–ª—É–±–Ω–∏–∫—É —Å–∞–º—ã–º —Å–æ–±–ª–∞–∑–Ω–∏—Ç–µ–ª—å–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º",
    "–ü—Ä–∏—à–ª–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç —Å–≤–æ–µ–π –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–∫—É–ø–∫–∏ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ",
    "–°–¥–µ–ª–∞–π –ø–∞—Ä–æ–¥–∏—é –Ω–∞ –∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ –∞–∫—Ç–µ—Ä–∞/–ø–µ–≤–∏—Ü—É",
    "–û–ø–∏—à–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ —Ç—Ä–µ–º—è —Å–ª–æ–≤–∞–º–∏, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç—ã",
    "–°–Ω–∏–º–∏ –≤–∏–¥–µ–æ, –∫–∞–∫ —Ç—ã –Ω–∞–Ω–æ—Å–∏—à—å –º–∞–∫–∏—è–∂ –æ–¥–Ω–æ–π —Ä—É–∫–æ–π",
    "–ü–æ–∫–∞–∂–∏, –∫–∞–∫ —Ç—ã –≤—ã–≥–ª—è–¥–∏—à—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è",
    "–°—ä–µ—à—å —á—Ç–æ-—Ç–æ –Ω–µ —Å–º–µ—à–∏–≤–∞—è –≤–∫—É—Å—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —à–æ–∫–æ–ª–∞–¥ —Å –≥–æ—Ä—á–∏—Ü–µ–π)",
    "–°–ø–æ–π –ø–µ—Å–Ω—é, –∑–∞–º–µ–Ω—è—è –≤—Å–µ —Å–ª–æ–≤–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ–º —Ñ—Ä—É–∫—Ç–æ–≤",
    "–°—Ç–∞–Ω—Ü—É–π –º–µ–¥–ª–µ–Ω–Ω—ã–π —Ç–∞–Ω–µ—Ü —Å –≤–æ–æ–±—Ä–∞–∂–∞–µ–º—ã–º –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º",
    "–ü—Ä–∏—à–ª–∏ —Ñ–æ—Ç–æ —Å–≤–æ–µ–π —Å–∞–º–æ–π —Å—Ç—Ä–∞–Ω–Ω–æ–π –ø–æ–∑—ã –¥–ª—è —Å–Ω–∞",
    "–°–Ω–∏–º–∏ –≤–∏–¥–µ–æ, –∫–∞–∫ —Ç—ã –ø—ã—Ç–∞–µ—à—å—Å—è –∫–æ—Å–Ω—É—Ç—å—Å—è —è–∑—ã–∫–æ–º –Ω–æ—Å–∞",
    "–ù–∞–ø–∏—à–∏ –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –≤ –ª—é–±–≤–∏, –∏—Å–ø–æ–ª—å–∑—É—è —Ç–æ–ª—å–∫–æ —ç–º–æ–¥–∑–∏"
]
# ===== –ë–õ–û–ö–ò–†–û–í–ö–ò –ò –°–û–°–¢–û–Ø–ù–ò–Ø =====
db_lock = Lock()
user_states = {}
state_lock = Lock()

# ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ë–û–¢–ê =====
load_dotenv()
TOKEN = os.getenv('TELEGRAM_TOKEN')
if not TOKEN:
    raise ValueError("–¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env-—Ñ–∞–π–ª–µ!")

bot = telebot.TeleBot(TOKEN, threaded=True, num_threads=10)

# ===== –£–õ–£–ß–®–ï–ù–ù–û–ï –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ö –ë–ê–ó–ï –î–ê–ù–ù–´–• =====
def get_db_connection():
    """–ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SQLite —Å —Ç–∞–π–º–∞—É—Ç–æ–º"""
    return sqlite3.connect(
        'wedding_bot.db',
        timeout=DB_TIMEOUT,
        check_same_thread=False,
        isolation_level=None
    )

# ===== –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ë–î =====
def init_db():
    """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏"""
    try:
        conn = get_db_connection()
        cursor = conn.cursor()
        
        # –í–∫–ª—é—á–µ–Ω–∏–µ WAL —Ä–µ–∂–∏–º–∞ –¥–ª—è –ª—É—á—à–µ–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã
        cursor.execute("PRAGMA journal_mode=WAL")
        cursor.execute("PRAGMA synchronous=NORMAL")
        cursor.execute("PRAGMA cache_size=-10000")  # 10MB –∫—ç—à–∞
        
        # –¢–∞–±–ª–∏—Ü–∞ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–π —Å –∏–Ω–¥–µ–∫—Å–æ–º
        cursor.execute('''
        CREATE TABLE IF NOT EXISTS congratulations (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            user_id INTEGER NOT NULL,
            user_name TEXT NOT NULL,
            message TEXT NOT NULL,
            timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
        )''')
        cursor.execute('CREATE INDEX IF NOT EXISTS congrats_user_idx ON congratulations(user_id)')
        
        # –¢–∞–±–ª–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π —Å –∏–Ω–¥–µ–∫—Å–æ–º
        cursor.execute('''
        CREATE TABLE IF NOT EXISTS moods (
            user_id INTEGER NOT NULL,
            score INTEGER CHECK(score BETWEEN 1 AND 5),
            note TEXT,
            timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
        )''')
        cursor.execute('CREATE INDEX IF NOT EXISTS moods_user_idx ON moods(user_id)')
        
        # –¢–∞–±–ª–∏—Ü–∞ –∫–∞–ø—Å—É–ª –≤—Ä–µ–º–µ–Ω–∏ —Å –∏–Ω–¥–µ–∫—Å–æ–º
        cursor.execute('''
        CREATE TABLE IF NOT EXISTS timecapsules (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            user_id INTEGER NOT NULL,
            message TEXT NOT NULL,
            send_at DATETIME NOT NULL,
            is_sent INTEGER DEFAULT 0,
            chat_id INTEGER NOT NULL
        )''')
        cursor.execute('CREATE INDEX IF NOT EXISTS capsules_user_idx ON timecapsules(user_id)')
        cursor.execute('CREATE INDEX IF NOT EXISTS capsules_sent_idx ON timecapsules(is_sent)')
        
        # –¢–∞–±–ª–∏—Ü–∞ –∂–µ–ª–∞–Ω–∏–π —Å –∏–Ω–¥–µ–∫—Å–æ–º
        cursor.execute('''
        CREATE TABLE IF NOT EXISTS wishes (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            user_id INTEGER NOT NULL,
            wish TEXT NOT NULL,
            timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
        )''')
        cursor.execute('CREATE INDEX IF NOT EXISTS wishes_user_idx ON wishes(user_id)')
        
        conn.commit()
        logger.info("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞")
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î: {e}")
        raise
    finally:
        if conn:
            conn.close()

# ===== –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–´–ï –§–£–ù–ö–¶–ò–ò –ë–ê–ó–´ –î–ê–ù–ù–´–• =====
def safe_db_execute(query, params=(), fetch=False):
    """–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π"""
    conn = None
    try:
        conn = get_db_connection()
        cursor = conn.cursor()
        
        with db_lock:
            cursor.execute(query, params)
            if fetch:
                result = cursor.fetchall()
                conn.commit()
                return result
            conn.commit()
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞: {e}\nQuery: {query}\nParams: {params}")
        if fetch:
            return []
        raise
    finally:
        if conn:
            conn.close()

# ===== –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–û–°–¢–û–Ø–ù–ò–Ø–ú–ò =====
def set_user_state(user_id, state_data):
    """–ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    with state_lock:
        user_states[user_id] = state_data

def get_user_state(user_id):
    """–ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    with state_lock:
        return user_states.get(user_id)
# ===== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò =====
def get_plural(number, one, few, many):
    """–°–∫–ª–æ–Ω–µ–Ω–∏–µ —Å–ª–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —á–∏—Å–ª–∞"""
    if number % 10 == 1 and number % 100 != 11:
        return one
    elif 2 <= number % 10 <= 4 and (number % 100 < 10 or number % 100 >= 20):
        return few
    else:
        return many

def get_random_photo():
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Ñ–æ—Ç–æ –∏–∑ –ø–∞–ø–∫–∏"""
    photo_dir = "photos"
    if os.path.exists(photo_dir):
        photos = [f for f in os.listdir(photo_dir) if f.endswith(('.jpg', '.jpeg', '.png'))]
        if photos:
            return os.path.join(photo_dir, random.choice(photos))
    return None

def fetch_cocktail(cocktail_name=None):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –∫–æ–∫—Ç–µ–π–ª–µ –∏–∑ API"""
    try:
        url = (f"https://www.thecocktaildb.com/api/json/v1/1/search.php?s={cocktail_name}"
              if cocktail_name else "https://www.thecocktaildb.com/api/json/v1/1/random.php")
        response = requests.get(url)
        data = response.json()
        return data['drinks'][0] if data.get('drinks') else None
    except Exception as e:
        logging.error(f"Cocktail API error: {str(e)}")
        return None
# ===== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ö–û–ú–ê–ù–î =====
@bot.message_handler(commands=['start'])
def send_welcome(message):
    welcome_text = """
üíñ <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ LoveBot!</b> üíñ
–Ø –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ —Å–µ—Ä–¥–µ—á–Ω—ã—Ö –¥–µ–ª–∞—Ö.
–ù–∞–ø–∏—à–∏—Ç–µ <b>/help</b> —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏.
"""
    try:
        with open("images/1.jpg", "rb") as photo:
            bot.send_photo(message.chat.id, photo, caption=welcome_text, parse_mode="HTML")
    except:
        bot.send_message(message.chat.id, welcome_text, parse_mode="HTML")


@bot.message_handler(commands=['help'])
def send_help(message):
    keyboard = types.InlineKeyboardMarkup(row_width=2)
    buttons = [
        types.InlineKeyboardButton("üíë –†–æ–º–∞–Ω—Ç–∏–∫–∞", callback_data="help_romance"),
        types.InlineKeyboardButton("üé≤ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è", callback_data="help_fun"),
        types.InlineKeyboardButton("üìä –£—Ç–∏–ª–∏—Ç—ã", callback_data="help_utils"),
        types.InlineKeyboardButton("üçπ –ö–æ–∫—Ç–µ–π–ª–∏", callback_data="help_cocktails")
    ]
    keyboard.add(*buttons)
    
    bot.send_message(
        message.chat.id,
        "üåü <b>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –ø–æ–º–æ—â–Ω–∏–∫–∞</b>\n–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:",
        reply_markup=keyboard,
        parse_mode="HTML"
    )

# –°–æ–∫—Ä–∞—â–µ–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
HELP_TEXTS = {
    "romance": """
<b>üíë –†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã</b>
/date - –ò–¥–µ—è –¥–ª—è —Å–≤–∏–¥–∞–Ω–∏—è
/love - –°–ª—É—á–∞–π–Ω—ã–π –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç
/anniversary - –ì–æ–¥–æ–≤—â–∏–Ω–∞ —Å–≤–∞–¥—å–±—ã
/memory - –°–ª—É—á–∞–π–Ω–æ–µ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–µ —Ñ–æ—Ç–æ
/wishlist - –°–ø–∏—Å–æ–∫ –∂–µ–ª–∞–Ω–∏–π 
/timecapsule - –ö–∞–ø—Å—É–ª–∞ –≤—Ä–µ–º–µ–Ω–∏
""",
    "fun": """
<b>üé≤ –†–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</b>
/truth_or_dare - –ò–≥—Ä–∞
/dispute - –†–µ—à–∏—Ç—å —Å–ø–æ—Ä
""",
    "utils": """
<b>üìä –ü–æ–ª–µ–∑–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã</b>
/mood - –û—Ç–º–µ—Ç–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
/mood_stats - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
/congratulate - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ
/congrats - –ü—Ä–æ—á–∏—Ç–∞—Ç—å –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è
/export_db - –°–∫–∞—á–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏
""",
    "cocktails": """
<b>üçπ –ö–æ–∫—Ç–µ–π–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã</b>
/drink - –°–ª—É—á–∞–π–Ω—ã–π —Ä–µ—Ü–µ–ø—Ç –∫–æ–∫—Ç–µ–π–ª—è
/cocktail [–Ω–∞–∑–≤–∞–Ω–∏–µ] - –ü–æ–∏—Å–∫ –∫–æ–∫—Ç–µ–π–ª—è
–ü—Ä–∏–º–µ—Ä: <code>/cocktail mojito</code>
"""
}

@bot.callback_query_handler(func=lambda call: call.data.startswith('help_'))
def show_help_category(call):
    category = call.data.split('_')[1]
    text = HELP_TEXTS.get(category, "–†–∞–∑–¥–µ–ª –Ω–µ –Ω–∞–π–¥–µ–Ω")
    
    try:
        # –ü—Ä–æ—Å—Ç–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –Ω–æ–≤—ã–º —Ç–µ–∫—Å—Ç–æ–º
        bot.edit_message_text(
            chat_id=call.message.chat.id,
            message_id=call.message.message_id,
            text=text,
            parse_mode="HTML"
        )
        # –ö–æ—Ä–æ—Ç–∫–∏–π –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏–π –æ—Ç–≤–µ—Ç
        bot.answer_callback_query(call.id)
    except Exception as e:
        # –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ø—Ä–æ—Å—Ç–æ –æ—Ç–≤–µ—á–∞–µ–º –±–µ–∑ —Ç–µ–∫—Å—Ç–∞
        bot.answer_callback_query(call.id)
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫–∞–∑–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {e}")



@bot.message_handler(commands=['date'])
def send_date_idea(message):
    ideas = random.sample(list(DATE_IDEAS.items()), 5)
    response = "üí° <b>–¢–æ–ø-5 –∏–¥–µ–π –¥–ª—è —Å–≤–∏–¥–∞–Ω–∏—è:</b>\n\n"
    
    for i, (idea, details) in enumerate(ideas, 1):
        link = f"\nüîó <a href='{details['url']}'>–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>" if details['url'] else ""
        response += (f"{i}. <b>{idea}</b>\n"
                    f"   {details['desc']}\n"
                    f"   üóìÔ∏è {details['season']}{link}\n\n")
    
    bot.send_message(message.chat.id, response, parse_mode='HTML', 
                    disable_web_page_preview=True)

@bot.message_handler(commands=['love'])
def send_compliment(message):
    bot.send_message(message.chat.id, random.choice(COMPLIMENTS))

@bot.message_handler(commands=['memory'])
def send_random_photo(message):
    photo_path = get_random_photo()
    if photo_path:
        with open(photo_path, 'rb') as photo:
            bot.send_photo(message.chat.id, photo, caption="–í–æ—Ç –≤–∞—à–µ —Å–ª—É—á–∞–π–Ω–æ–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–µ ‚ù§Ô∏è")
    else:
        bot.send_message(message.chat.id, "–§–æ—Ç–æ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã üò¢ –î–æ–±–∞–≤—å—Ç–µ –∏—Ö –≤ –ø–∞–ø–∫—É /photos")

@bot.message_handler(commands=['anniversary'])
def wedding_anniversary(message):
    now = datetime.now(pytz.timezone(TIMEZONE))
    wedding_day = datetime.strptime(WEDDING_DATE, "%Y-%m-%d").replace(tzinfo=pytz.timezone(TIMEZONE))
    delta = now - wedding_day
    
    years = delta.days // 365
    months = (delta.days % 365) // 30
    days = delta.days
    hours = delta.seconds // 3600
    
    anniversary_text = (f"üíç –í–∞—à–∞ —Å–≤–∞–¥—å–±–∞ –±—ã–ª–∞ {wedding_day.strftime('%d.%m.%Y')}\n"
                      f"‚è≥ –° —Ç–µ—Ö –ø–æ—Ä –ø—Ä–æ—à–ª–æ:\n"
                      f"‚Ä¢ {years} {get_plural(years, '–≥–æ–¥', '–≥–æ–¥–∞', '–ª–µ—Ç')}\n"
                      f"‚Ä¢ {months} {get_plural(months, '–º–µ—Å—è—Ü', '–º–µ—Å—è—Ü–∞', '–º–µ—Å—è—Ü–µ–≤')}\n"
                      f"‚Ä¢ {days} {get_plural(days, '–¥–µ–Ω—å', '–¥–Ω—è', '–¥–Ω–µ–π')}\n"
                      f"‚Ä¢ {hours} {get_plural(hours, '—á–∞—Å', '—á–∞—Å–∞', '—á–∞—Å–æ–≤')}\n\n"
                      f"–°–ª–µ–¥—É—é—â–∞—è –≥–æ–¥–æ–≤—â–∏–Ω–∞ —á–µ—Ä–µ–∑ {365 - (delta.days % 365)} –¥–Ω–µ–π!")
    
    bot.send_message(message.chat.id, anniversary_text)


@bot.message_handler(commands=['congrats'])
def show_congrats(message):
    try:
        conn = sqlite3.connect('wedding_bot.db')
        cursor = conn.cursor()
        cursor.execute('SELECT user_name, message, timestamp FROM congratulations ORDER BY timestamp DESC LIMIT 50')
        congrats = cursor.fetchall()
        
        if congrats:
            response = "üíå –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è:\n\n" + "\n".join(
                [f"üè∑Ô∏è {item[0]} ({item[2][:10]}):\n{item[1]}\n" for item in congrats])
            bot.send_message(message.chat.id, response)
        else:
            bot.send_message(message.chat.id, "–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–π üò¢")
    except Exception as e:
        bot.send_message(message.chat.id, f"‚ö†Ô∏è –û—à–∏–±–∫–∞: {e}")
    finally:
        conn.close()

@bot.message_handler(commands=['mood'])
def ask_mood(message):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True, one_time_keyboard=True)
    markup.row("1 üò¢", "2 üôÅ", "3 üòê")
    markup.row("4 üôÇ", "5 üòç")
    msg = bot.send_message(message.chat.id, "–û—Ü–µ–Ω–∏—Ç–µ –≤–∞—à–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–µ–≥–æ–¥–Ω—è:", reply_markup=markup)
    bot.register_next_step_handler(msg, process_mood)

def process_mood(message):
    try:
        mood_map = {"1 üò¢":1, "2 üôÅ":2, "3 üòê":3, "4 üôÇ":4, "5 üòç":5}
        score = mood_map.get(message.text, 3)
        
        conn = sqlite3.connect('wedding_bot.db')
        cursor = conn.cursor()
        cursor.execute("INSERT INTO moods (user_id, score) VALUES (?, ?)",
                      (message.from_user.id, score))
        conn.commit()
        
        reactions = {
            1: "–û–±–Ω–∏–º–∞—é –≤–∞—Å ü§ó –ú–æ–∂–µ—Ç, —á–∞—à–µ—á–∫—É —á–∞—è?",
            2: "–ù–∞–¥–µ—é—Å—å, –¥–µ–Ω—å —Å—Ç–∞–Ω–µ—Ç –ª—É—á—à–µ üåà",
            5: "–û—Ç–ª–∏—á–Ω–æ! –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ–º —Å –±–ª–∏–∑–∫–∏–º–∏ üòä"
        }
        if score in reactions:
            bot.send_message(message.chat.id, reactions[score], reply_markup=types.ReplyKeyboardRemove())
        else:
            bot.send_message(message.chat.id, "–°–ø–∞—Å–∏–±–æ!", reply_markup=types.ReplyKeyboardRemove())
    except Exception as e:
        bot.reply_to(message, f"‚ö†Ô∏è –û—à–∏–±–∫–∞: {e}")
    finally:
        conn.close()

@bot.message_handler(commands=['mood_stats'])
def mood_stats(message):
    try:
        conn = sqlite3.connect('wedding_bot.db')
        cursor = conn.cursor()
        cursor.execute('''
        SELECT AVG(score), COUNT(*), SUM(CASE WHEN score < 3 THEN 1 ELSE 0 END) 
        FROM moods WHERE user_id = ? AND timestamp >= datetime('now', '-30 days')
        ''', (message.from_user.id,))
        
        avg_score, total_days, bad_days = cursor.fetchone()
        avg_score = avg_score or 0
        emoji_index = min(4, max(0, int(round(avg_score)) - 1))
        
        response = (f"üìä <b>–í–∞—à–∞ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</b>\n\n"
                   f"–°—Ä–µ–¥–Ω–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: {avg_score:.1f} {EMOJI_MAP[emoji_index]}\n"
                   f"–î–Ω–µ–π —Å –æ—Ü–µ–Ω–∫–æ–π: {total_days or 0}\n"
                   f"–°–ª–æ–∂–Ω—ã—Ö –¥–Ω–µ–π: {bad_days or 0}\n\n"
                   f"–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /mood –¥–ª—è –Ω–æ–≤–æ–π –æ—Ü–µ–Ω–∫–∏")
        
        bot.send_message(message.chat.id, response, parse_mode='HTML')
    except Exception as e:
        bot.reply_to(message, f"‚ö†Ô∏è –û—à–∏–±–∫–∞: {e}")
    finally:
        conn.close()

@bot.message_handler(commands=['truth_or_dare'])
def truth_or_dare(message):
    markup = types.InlineKeyboardMarkup()
    btn_truth = types.InlineKeyboardButton("–ü—Ä–∞–≤–¥–∞", callback_data="truth")
    btn_dare = types.InlineKeyboardButton("–î–µ–π—Å—Ç–≤–∏–µ", callback_data="dare")
    markup.add(btn_truth, btn_dare)
    bot.send_message(message.chat.id, "–í—ã–±–µ—Ä–∏: –ü—Ä–∞–≤–¥—É –∏–ª–∏ –î–µ–π—Å—Ç–≤–∏–µ? üòè", reply_markup=markup)

@bot.callback_query_handler(func=lambda call: call.data in ["truth", "dare"])
def handle_truth_or_dare(call):
    response = random.choice(TRUTHS) if call.data == "truth" else random.choice(DARES)
    bot.edit_message_text(chat_id=call.message.chat.id, message_id=call.message.message_id,
                         text=f"‚ú® –¢–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ:\n\n{response}")

# 2. –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∂–µ–ª–∞–Ω–∏–π (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏)
def show_wishes(chat_id, user_id, bot):
    try:
        conn = sqlite3.connect('wishlist.db', check_same_thread=False)
        c = conn.cursor()
        c.execute("SELECT wish FROM wishes WHERE user_id=?", (user_id,))
        wishes = c.fetchall()
        
        if wishes:
            response = "üéÅ –í–∞—à —Å–ø–∏—Å–æ–∫ –∂–µ–ª–∞–Ω–∏–π:\n\n" + "\n".join([f"‚Ä¢ {wish[0]}" for wish in wishes])
        else:
            response = "–í–∞—à —Å–ø–∏—Å–æ–∫ –∂–µ–ª–∞–Ω–∏–π –ø–æ–∫–∞ –ø—É—Å—Ç."
            
        bot.send_message(chat_id, response)
    except Exception as e:
        bot.send_message(chat_id, f"‚ö†Ô∏è –û—à–∏–±–∫–∞: {str(e)}")
    finally:
        if conn:
            conn.close()

# 3. –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–æ–≤–æ–≥–æ –∂–µ–ª–∞–Ω–∏—è
def process_wish_step(message, user_id, bot):
    try:
        conn = sqlite3.connect('wishlist.db', check_same_thread=False)
        c = conn.cursor()
        c.execute("INSERT INTO wishes (user_id, wish) VALUES (?, ?)", 
                 (user_id, message.text))
        conn.commit()
        bot.send_message(message.chat.id, "‚úÖ –ñ–µ–ª–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ!")
    except Exception as e:
        bot.send_message(message.chat.id, f"‚ö†Ô∏è –û—à–∏–±–∫–∞: {str(e)}")
    finally:
        if conn:
            conn.close()

# 4. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /wishlist
@bot.message_handler(commands=['wishlist'])
def handle_wishlist(message):
    markup = types.InlineKeyboardMarkup()
    markup.add(types.InlineKeyboardButton("–î–æ–±–∞–≤–∏—Ç—å –∂–µ–ª–∞–Ω–∏–µ", callback_data="add_wish"))
    markup.add(types.InlineKeyboardButton("–ü–æ–∫–∞–∑–∞—Ç—å –º–æ–∏ –∂–µ–ª–∞–Ω–∏—è", callback_data="show_wishes"))
    markup.add(types.InlineKeyboardButton("–û—á–∏—Å—Ç–∏—Ç—å —Å–ø–∏—Å–æ–∫", callback_data="clear_wishes"))
    
    bot.send_message(message.chat.id, 
                   "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:", 
                   reply_markup=markup)

# 5. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–æ–∫
@bot.callback_query_handler(func=lambda call: True)
def handle_wishlist_actions(call):
    if call.data == "add_wish":
        msg = bot.send_message(call.message.chat.id, "üìù –í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∂–µ–ª–∞–Ω–∏–µ:")
        bot.register_next_step_handler(msg, process_wish_step, call.from_user.id, bot)
    elif call.data == "show_wishes":
        show_wishes(call.message.chat.id, call.from_user.id, bot)
    elif call.data == "clear_wishes":
        handle_clear_wishes(call)

# 6. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—á–∏—Å—Ç–∫–∏ —Å–ø–∏—Å–∫–∞
def handle_clear_wishes(call):
    try:
        conn = sqlite3.connect('wishlist.db', check_same_thread=False)
        c = conn.cursor()
        c.execute("DELETE FROM wishes WHERE user_id=?", (call.from_user.id,))
        conn.commit()
        bot.answer_callback_query(call.id, "‚úÖ –°–ø–∏—Å–æ–∫ –∂–µ–ª–∞–Ω–∏–π –æ—á–∏—â–µ–Ω!")
    except Exception as e:
        bot.answer_callback_query(call.id, f"‚ö†Ô∏è –û—à–∏–±–∫–∞: {str(e)}")
    finally:
        if conn:
            conn.close()


# –†–µ—à–µ–Ω–∏–µ —Å–ø–æ—Ä–æ–≤
@bot.message_handler(commands=['dispute'])
def solve_dispute(message):
    decision = random.choice(["–¢—ã", "–¢–≤–æ—è –ø–æ–ª–æ–≤–∏–Ω–∫–∞"])
    bot.send_message(message.chat.id, f"–°–µ–≥–æ–¥–Ω—è –º–æ–µ—Ç –ø–æ—Å—É–¥—É: {decision} üçΩÔ∏è")

@bot.message_handler(commands=['drink'])
def send_random_cocktail(message):
    cocktail = fetch_cocktail()
    if not cocktail:
        bot.reply_to(message, "üö´ –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–∫—Ç–µ–π–ª—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ!")
        return

    ingredients = "\n".join(
        f"‚Ä¢ {cocktail[f'strIngredient{i}']} - {cocktail.get(f'strMeasure{i}', '–ø–æ –≤–∫—É—Å—É')}"
        for i in range(1, 16) if cocktail.get(f'strIngredient{i}')
    )
    
    text = (f"üçπ <b>{cocktail['strDrink']}</b> ({cocktail['strAlcoholic']})\n"
           f"<i>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</i> {cocktail['strCategory']}\n"
           f"<i>–°—Ç–µ–∫–ª–æ:</i> {cocktail['strGlass']}\n\n"
           f"<b>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:</b>\n{ingredients}\n\n"
           f"<b>–†–µ—Ü–µ–ø—Ç:</b>\n{cocktail['strInstructions']}")
    
    if cocktail.get('strDrinkThumb'):
        bot.send_photo(message.chat.id, cocktail['strDrinkThumb'], caption=text, parse_mode="HTML")
    else:
        bot.send_message(message.chat.id, text, parse_mode="HTML")

@bot.message_handler(commands=['cocktail'])
def search_cocktail(message):
    try:
        cocktail_name = message.text.split(' ', 1)[1] if len(message.text.split()) > 1 else None
        
        if not cocktail_name:
            bot.reply_to(message, "‚ÑπÔ∏è –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä: <code>/cocktail mojito</code>", parse_mode="HTML")
            return

        cocktail = fetch_cocktail(cocktail_name)
        if not cocktail:
            bot.reply_to(message, f"üîç –ö–æ–∫—Ç–µ–π–ª—å '{cocktail_name}' –Ω–µ –Ω–∞–π–¥–µ–Ω")
            return

        ingredients = "\n".join(
            f"‚Ä¢ {cocktail[f'strIngredient{i}']} - {cocktail.get(f'strMeasure{i}', '–ø–æ –≤–∫—É—Å—É')}"
            for i in range(1, 16) if cocktail.get(f'strIngredient{i}')
        )
        
        text = (f"üçπ <b>{cocktail['strDrink']}</b> ({cocktail['strAlcoholic']})\n"
               f"<i>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</i> {cocktail['strCategory']}\n"
               f"<i>–°—Ç–µ–∫–ª–æ:</i> {cocktail['strGlass']}\n\n"
               f"<b>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:</b>\n{ingredients}\n\n"
               f"<b>–†–µ—Ü–µ–ø—Ç:</b>\n{cocktail['strInstructions']}")
        
        if cocktail.get('strDrinkThumb'):
            bot.send_photo(message.chat.id, cocktail['strDrinkThumb'], caption=text, parse_mode="HTML")
        else:
            bot.send_message(message.chat.id, text, parse_mode="HTML")
            
    except IndexError:
        bot.reply_to(message, "‚ÑπÔ∏è –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä: <code>/cocktail mojito</code>", parse_mode="HTML")
    except Exception as e:
        logging.error(f"Error in search_cocktail: {str(e)}")
        bot.reply_to(message, "‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –∫–æ–∫—Ç–µ–π–ª—è")

@bot.message_handler(commands=['export_db'])
def export_db(message):
    if message.from_user.id in ADMINS:
        try:
            with open('wedding_bot.db', 'rb') as db_file:
                bot.send_document(message.chat.id, db_file)
        except Exception as e:
            bot.reply_to(message, f"‚ö†Ô∏è –û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: {e}")
    else:
        bot.reply_to(message, "üö´ –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤")

# ===== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ö–û–ú–ê–ù–î –° –£–ß–ï–¢–û–ú –ú–ù–û–ì–û–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–û–ô –†–ê–ë–û–¢–´ =====
@bot.message_handler(commands=['congratulate'])
def start_congratulation(message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–π —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏"""
    try:
        if message.from_user.id in ADMINS:
            bot.reply_to(message, "–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –ø–æ–∑–¥—Ä–∞–≤–ª—è—Ç—å —Å–∞–º–∏ —Å–µ–±—è üòä")
            return
            
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        if len(user_states) > MAX_CONCURRENT_USERS * 0.8:
            bot.reply_to(message, "–°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ")
            return
            
        set_user_state(message.from_user.id, {'waiting_for_congratulation': True})
        msg = bot.reply_to(message, "–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ:")
        bot.register_next_step_handler(msg, process_congratulation)
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≤ start_congratulation: {e}")
        bot.reply_to(message, "‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ")

def process_congratulation(message):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è"""
    try:
        user_state = get_user_state(message.from_user.id)
        if not user_state or not user_state.get('waiting_for_congratulation'):
            bot.reply_to(message, "–°–µ—Å—Å–∏—è —É—Å—Ç–∞—Ä–µ–ª–∞, –Ω–∞—á–Ω–∏—Ç–µ –∑–∞–Ω–æ–≤–æ")
            return
            
        safe_db_execute(
            "INSERT INTO congratulations (user_id, user_name, message) VALUES (?, ?, ?)",
            (message.from_user.id, message.from_user.first_name, message.text)
        )
        bot.reply_to(message, "‚úÖ –í–∞—à–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!")
        set_user_state(message.from_user.id, None)
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≤ process_congratulation: {e}")
        bot.reply_to(message, "‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ")


# ===== –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–´–ô –ü–õ–ê–ù–ò–†–û–í–©–ò–ö –ö–ê–ü–°–£–õ –í–†–ï–ú–ï–ù–ò =====
scheduler = BackgroundScheduler({
    'apscheduler.job_defaults.max_instances': 100,
    'apscheduler.executors.default': {
        'class': 'apscheduler.executors.pool:ThreadPoolExecutor',
        'max_workers': 30
    }
})

def check_and_send_capsules():
    """–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞–ø—Å—É–ª"""
    try:
        capsules = safe_db_execute(
            "SELECT id, user_id, message, chat_id FROM timecapsules "
            "WHERE is_sent = 0 AND send_at <= datetime('now')",
            fetch=True
        )
        
        for capsule in capsules:
            try:
                bot.send_message(
                    capsule[3], 
                    f"üì¨ –ü—Ä–∏—à–ª–æ –≤—Ä–µ–º—è –≤–∞—à–µ–π –∫–∞–ø—Å—É–ª—ã!\n\n{capsule[2]}"
                )
                safe_db_execute(
                    "UPDATE timecapsules SET is_sent = 1 WHERE id = ?",
                    (capsule[0],)
                )
            except Exception as e:
                logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–∞–ø—Å—É–ª—ã {capsule[0]}: {e}")
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≤ check_and_send_capsules: {e}")

@bot.message_handler(commands=['timecapsule'])
def timecapsule_command(message):
    msg = bot.send_message(message.chat.id, "üì® –í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –±—É–¥—É—â–µ–≥–æ:")
    bot.register_next_step_handler(msg, process_capsule_message)

def process_capsule_message(message):
    user_data = {'text': message.text}
    msg = bot.send_message(message.chat.id, "–ß–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –æ—Ç–ø—Ä–∞–≤–∏—Ç—å? (1-365)")
    bot.register_next_step_handler(msg, process_capsule_days, user_data)

def process_capsule_days(message, user_data):
    try:
        days = int(message.text)
        if not 1 <= days <= 365:
            raise ValueError("–ß–∏—Å–ª–æ –¥–Ω–µ–π –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 1 –¥–æ 365")
        
        send_date = datetime.now() + timedelta(days=days)
        user_id = message.from_user.id
        
        conn = sqlite3.connect('wedding_bot.db')
        cursor = conn.cursor()
        cursor.execute("INSERT INTO timecapsules (user_id, message, send_at) VALUES (?, ?, ?)",
                     (user_id, user_data['text'], send_date))
        conn.commit()
        
        scheduler.add_job(
            send_capsule,
            'date',
            run_date=send_date,
            args=[user_id, user_data['text'], message.chat.id]
        )
        
        bot.send_message(message.chat.id, f"‚è≥ –ö–∞–ø—Å—É–ª–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞! –û—Ç–∫—Ä–æ–µ—Ç—Å—è {send_date.strftime('%d.%m.%Y')}")
    except ValueError:
        bot.reply_to(message, "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 365")
    except Exception as e:
        bot.reply_to(message, f"‚ö†Ô∏è –û—à–∏–±–∫–∞: {e}")
    finally:
        conn.close()

def send_capsule(user_id, message_text, chat_id):
    try:
        bot.send_message(chat_id, f"üì¨ –ü—Ä–∏—à–ª–æ –≤—Ä–µ–º—è –≤–∞—à–µ–π –∫–∞–ø—Å—É–ª—ã!\n\n{message_text}")
        
        conn = sqlite3.connect('wedding_bot.db')
        cursor = conn.cursor()
        cursor.execute("UPDATE timecapsules SET is_sent=1 WHERE user_id=? AND message=? AND is_sent=0", 
                      (user_id, message_text))
        conn.commit()
    except Exception as e:
        logging.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–∞–ø—Å—É–ª—ã: {e}")
    finally:
        conn.close()
# ===== –ó–ê–ü–£–°–ö –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò =====
#init_db()
scheduler.add_job(check_and_send_capsules, 'interval', minutes=5)
scheduler.start()

# ===== –ó–ê–ü–£–°–ö –ë–û–¢–ê –° –û–ë–†–ê–ë–û–¢–ö–û–ô –û–®–ò–ë–û–ö =====
if __name__ == "__main__":
    logger.info("–ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...")
    try:
        bot.infinity_polling(timeout=60, long_polling_timeout=30)
    except Exception as e:
        logger.critical(f"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")
    finally:
        scheduler.shutdown()
        logger.info("–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")